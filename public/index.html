<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Personal Website</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/three@0.159.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.159.0/examples/js/controls/OrbitControls.js"></script>
  </head>
  <body>
    <header class="site-nav">
      <div class="nav-inner">
        <div class="brand">Matthew Ren</div>
        <nav class="links">
          <a href="#about" data-tab="about" class="nav-link active">About</a>
          <a href="#game" data-tab="game" class="nav-link">Game</a>
          <a href="#style" data-tab="style" class="nav-link">Style Guide</a>
        </nav>
      </div>
    </header>

    

    <main>
      <section id="game-tab" class="tab">
        <div id="hud">
          <div class="row">
            <div class="card">Score: <span id="score">0</span></div>
          </div>
          <div class="row small">
            <div class="pill">W/A/S/D: Move</div>
            <div class="pill">Right Click: Pan camera</div>
            <div class="pill">Space: Pick up nearby disc</div>
            <div class="pill">Left Click: Shoot</div>
            <div class="pill">R: Reset</div>
          </div>
        </div>

        <!-- Big bottom timer -->
        <div id="big-timer" class="card">
          <span id="timer">0:00.000</span>
        </div>

        <!-- Leaderboard visible only on Game tab, right side -->
        <div id="leaderboard" class="card">
          <div class="lb-header" id="lbHeaderLink">Leaderboard</div>
          <ol id="leaderboard-list"></ol>
        </div>

        <div id="overlay" class="hidden">
          <div class="modal">
            <h1>Goal!</h1>
            <p>Nice shot. Press Enter to continue.</p>
          </div>
        </div>

        <div id="end-overlay" class="hidden">
          <div class="modal">
            <h1>Finished!</h1>
            <p id="end-summary"></p>
            <div class="row small" style="margin-top:10px">
              <div class="pill">Press R to restart</div>
            </div>
          </div>
        </div>

        <div id="container"></div>
      </section>

      <section id="about-tab" class="tab active">
        <div class="about-wrap">
          <h1>Matthew Ren</h1>
          <p>Hi, I’m Matthew Ren. I like doing things and playing games.</p>
          <div class="about-grid">
            <div class="about-card">
              <h2>What I’m into</h2>
              <ul>
                <li>Minecraft</li>
                <li>Pokemon GO</li>
                <li>VEX / FRC</li>
                <li>Ultimate Frisbee</li>
                <li>Dodgeball</li>
                <li>Biking</li>
                <li>Coding</li>
              </ul>
            </div>
            <div class="about-card game-card" id="sooky-card" data-universe-id="7248594700">
              <h2>Sooky Game</h2>
              <div class="game-stats" id="sooky-stats">
                <span class="stat"><span id="sooky-likes">—</span> Likes</span>
                <span class="sep">•</span>
                <span class="stat"><span id="sooky-visits">—</span> Visits</span>
                <span class="sep">•</span>
                <span class="stat"><span id="sooky-playing">—</span> Playing</span>
                <span class="sep">•</span>
                <span class="stat"><span id="sooky-favorites">—</span> Favorites</span>
              </div>
              <div class="game-thumb">
                <img id="sooky-thumb" src="sookygame%20thumbnail.png" alt="Sooky Game thumbnail" loading="lazy" />
              </div>
              <div id="sooky-desc" data-lockdesc="true">
                <p>This game is very sooky (im scared).</p>
                <p>Try to survive 2 minutes in a procedurally generated map. Fight enemies to get points, and use those points to buy more weapons.</p>
                <p>Made by: Zachary Zhang, Matthew Ren, Dawson Peng, Mark Dai, Mike Dai, James Grazcyk</p>
              </div>
              <div class="row small" style="margin-top:8px">
                <a class="pill" href="https://www.roblox.com/games/108476677636434/Sooky-Gam" target="_blank" rel="noopener noreferrer">Play on Roblox →</a>
              </div>
            </div>
            <div class="about-card github-card" id="github-card">
              <h2>GitHub</h2>
              <p id="about-gh-last" style="margin:6px 0 8px">Loading last activity…</p>
              <div class="gh-chart-box">
                <img id="about-gh-chart" alt="GitHub contributions chart" loading="lazy" />
              </div>
              <h3 class="lb-subheader" style="margin-top:10px">Recent Repositories</h3>
              <ul id="about-gh-repos" class="gh-repo-list"></ul>
              <div class="row small" style="margin-top:8px">
                <a class="repo-chip repo-action" id="open-gh-chip" href="https://github.com/RatthewMen">
                  <img class="avatar" alt="avatar" />
                  <span class="name">Open GitHub Page →</span>
                  <span class="meta"><span class="handle"></span></span>
                </a>
              </div>
            </div>
            <div class="about-card">
              <h2>Contact</h2>
              <p>Email: <span class="mono">goofygoober6769420@gmail.com</span></p>
              <div class="row small" style="margin-top:8px">
                <a class="pill" href="https://github.com/RatthewMen" target="_blank" rel="noopener noreferrer">GitHub Profile →</a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="style-tab" class="tab">
        <div class="style-wrap">
          <h1>Style Guide</h1>
          <p>Reference for colors, typography, components, and layout tokens used on this site.</p>

          <h2>Colors</h2>
          <div class="swatches">
            <div class="swatch" style="--c:#7ccfff"><span>#7CCFFF</span></div>
            <div class="swatch" style="--c:#d7e3f3"><span>#D7E3F3</span></div>
            <div class="swatch" style="--c:#19232f"><span>#19232F</span></div>
            <div class="swatch" style="--c:#0f1520"><span>#0F1520</span></div>
            <div class="swatch" style="--c:#1c7a3a"><span>#1C7A3A</span></div>
          </div>

          <h2>Typography</h2>
          <div class="type-scale">
            <div><span class="label">H1</span><h1>Heading One</h1></div>
            <div><span class="label">H2</span><h2>Heading Two</h2></div>
            <div><span class="label">Body</span><p>Body text example. Quick brown fox jumps over the lazy dog.</p></div>
            <div><span class="label mono">Mono</span><p class="mono">0123456789 abcdef MONO SAMPLE</p></div>
          </div>

          <h2>Components</h2>
          <div class="sg-grid">
            <div class="about-card">
              <h3>Card</h3>
              <p>Cards use a semi-transparent surface with a subtle border.</p>
            </div>
            <div class="about-card">
              <h3>Pills</h3>
              <div class="row small" style="margin-top:8px">
                <div class="pill">Example Pill</div>
                <div class="pill">Shortcut ⌘K</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="leaderboard-tab" class="tab">
        <div class="about-wrap">
          <div class="row small" style="margin-bottom:10px">
            <a href="#game" class="pill" id="back-to-game">← Back to Game</a>
          </div>
          <h1>Leaderboard</h1>
          <p>Live best runs across all players.</p>
          <h2 class="lb-subheader">All Runs</h2>
          <ol id="leaderboard-full-list"></ol>
        </div>
      </section>
    </main>

    <script>
      (function(){
        const links = document.querySelectorAll('.nav-link');
        function activate(tab){
          document.querySelectorAll('.tab').forEach(s => s.classList.remove('active'));
          document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
          const id = `#${tab}-tab`;
          const section = document.querySelector(id);
          if (section) section.classList.add('active');
          const activeLink = document.querySelector(`[data-tab="${tab}"]`);
          if (activeLink) activeLink.classList.add('active');
          // Lock page scroll on Game tab only
          document.body.classList.toggle('lock-scroll', tab === 'game');
        }
        // Expose for external triggers (e.g., clicking sidebar Leaderboard)
        window.activateTab = activate;
        links.forEach(l => l.addEventListener('click', e => {
          const tab = l.getAttribute('data-tab');
          // Only intercept internal hash tabs; allow normal navigation for full pages
          if (tab) {
            e.preventDefault();
            activate(tab);
          }
        }));
        // Initial activation based on hash, default to about
        const initial = (location.hash ? location.hash.slice(1) : 'about');
        activate(initial);
        window.addEventListener('hashchange', () => {
          const tab = (location.hash ? location.hash.slice(1) : 'about');
          activate(tab);
        });
      })();
    </script>

    <script>
      (function(){
        // Initialize GitHub About card when visible, then auto-refresh via module
        const card = document.getElementById('github-card');
        if (!card) return;
        const username = 'RatthewMen';
        let loading = false;
        const load = () => {
          if (loading) return; loading = true;
          let tries = 0;
          const tryInit = () => {
            if (window.GitHubUI && typeof window.GitHubUI.initAboutCard === 'function') {
              window.GitHubUI.initAboutCard({
                username,
                chartImgId: 'about-gh-chart',
                lastElId: 'about-gh-last',
                reposListId: 'about-gh-repos',
                refreshMs: 120000
              });
            } else if (tries++ < 50) {
              setTimeout(tryInit, 200);
            }
          };
          tryInit();
        };
        const io = new IntersectionObserver((entries)=>{
          entries.forEach(en => { if (en.isIntersecting) { load(); io.disconnect(); } });
        }, { root: null, threshold: 0.25 });
        io.observe(card);
        // Fallback init in case IntersectionObserver doesn't fire (e.g., quick nav)
        document.addEventListener('DOMContentLoaded', () => {
          setTimeout(() => { load(); }, 1200);
        });
      })();
    </script>

    <script>
      (function(){
        // Mouse-follow gradient for About tab
        const about = document.getElementById('about-tab');
        if (!about) return;
        let raf = 0;
        function handleMove(e){
          const rect = about.getBoundingClientRect();
          const x = ((e.clientX - rect.left) / rect.width) * 100;
          const y = ((e.clientY - rect.top) / rect.height) * 100;
          if (raf) cancelAnimationFrame(raf);
          raf = requestAnimationFrame(() => {
            about.style.setProperty('--gx', x.toFixed(1) + '%');
            about.style.setProperty('--gy', y.toFixed(1) + '%');
          });
        }
        about.addEventListener('mousemove', handleMove);
        about.addEventListener('mouseleave', () => {
          about.style.setProperty('--gx', '70%');
          about.style.setProperty('--gy', '10%');
        });
      })();
    </script>

    <script>
      (function(){
        // Make the small Leaderboard header open the full page
        const header = document.getElementById('lbHeaderLink');
        if (header) {
          header.addEventListener('click', () => {
            if (window.activateTab) window.activateTab('leaderboard');
            location.hash = '#leaderboard';
          });
        }

        const backBtn = document.getElementById('back-to-game');
        if (backBtn) {
          backBtn.addEventListener('click', () => {
            if (window.activateTab) window.activateTab('game');
          });
        }

        function renderFullLeaderboard(){
          const list = document.getElementById('leaderboard-full-list');
          if (!list || !window.Leaderboard) return;
          const getAll = window.Leaderboard.getAllRows ? window.Leaderboard.getAllRows : () => [];
          const fmt = window.Leaderboard.formatMs ? window.Leaderboard.formatMs : (x => `${x} ms`);
          const rows = getAll();
          list.innerHTML = '';
          if (!Array.isArray(rows) || rows.length === 0) {
            const li = document.createElement('li');
            li.textContent = 'Loading leaderboard…';
            list.appendChild(li);
            return;
          }
          // Render up to first 100 runs for readability
          rows.slice(0, 100).forEach((row, idx) => {
            const li = document.createElement('li');
            li.textContent = `${idx + 1}. ${row.username} — ${fmt(row.timeMs)}`;
            list.appendChild(li);
          });
        }

        // Refresh when top list changes (acts as a live update signal)
        const trySubscribe = () => {
          if (window.Leaderboard && typeof window.Leaderboard.subscribeTop === 'function') {
            window.Leaderboard.subscribeTop(() => { renderFullLeaderboard(); });
          } else {
            setTimeout(trySubscribe, 300);
          }
        };
        trySubscribe();

        // Periodically refresh while on the leaderboard tab
        setInterval(() => {
          const sec = document.getElementById('leaderboard-tab');
          if (sec && sec.classList.contains('active')) renderFullLeaderboard();
        }, 3000);
      })();
    </script>

    
    <script>window.SOOKY_PROXY_URL='https://sooky-proxy.watershipbunny1021.workers.dev';</script>
    

    <script>
      (function(){
        // Sooky stats via Cloudflare Worker proxy + local cache (no direct Roblox fetches)
        const likesEl = document.getElementById('sooky-likes');
        const visitsEl = document.getElementById('sooky-visits');
        const playingEl = document.getElementById('sooky-playing');
        const favsEl = document.getElementById('sooky-favorites');
        const formatNumber = (n) => (typeof n === 'number' ? n.toLocaleString() : '—');

        const ONE_HOUR = 60 * 60 * 1000;
        const STATS_KEY = 'sooky:stats';
        const readStats = () => { try { const raw = localStorage.getItem(STATS_KEY); return raw ? JSON.parse(raw) : null; } catch(_) { return null; } };
        const writeStats = (stats) => { try { localStorage.setItem(STATS_KEY, JSON.stringify({ data: stats, fetchedAt: Date.now() })); } catch(_) {} };
        const stats = {};
        const renderStats = (s) => {
          if (!s) return;
          if (likesEl && s.likes !== undefined) likesEl.textContent = formatNumber(s.likes);
          if (visitsEl && s.visits !== undefined) visitsEl.textContent = formatNumber(s.visits);
          if (playingEl && s.playing !== undefined) playingEl.textContent = formatNumber(s.playing);
          if (favsEl && s.favorites !== undefined) favsEl.textContent = formatNumber(s.favorites);
        };
        const setStat = (k, v) => { if (typeof v === 'number' && isFinite(v)) { stats[k] = v; renderStats(stats); writeStats(stats); } };

        // Render cached stats immediately
        const cached = readStats();
        if (cached && cached.data) renderStats(cached.data);

        function fetchViaProxy(){
          const proxyUrl = (window.SOOKY_PROXY_URL || '').trim();
          if (!proxyUrl) return;
          fetch(`${proxyUrl}?universeId=7248594700&placeId=108476677636434`)
            .then(r => r.ok ? r.json() : Promise.reject())
            .then(s => {
              if (!s) return;
              if (s.likes != null) setStat('likes', Number(s.likes));
              if (s.visits != null) setStat('visits', Number(s.visits));
              if (s.playing != null) setStat('playing', Number(s.playing));
              if (s.favorites != null) setStat('favorites', Number(s.favorites));
            })
            .catch(() => {});
        }

        fetchViaProxy();
        setInterval(fetchViaProxy, ONE_HOUR);
      })();
    </script>

<script>
  window.FIREBASE_CONFIG = {
    apiKey: "AIzaSyCqU_xNT72v1mA56sy17ZSXLg_umWQsyw",
    authDomain: "personalwebsite-ratthew.firebaseapp.com",
    projectId: "personalwebsite-ratthew",
    databaseURL: "https://personalwebsite-ratthew-default-rtdb.firebaseio.com",
    storageBucket: "personalwebsite-ratthew.firebasestorage.app",
    messagingSenderId: "42101150103",
    appId: "1:42101150103:web:c00594a661fb2f9a5434d2"
  };
</script>
    <script>window.USE_REALTIME_DB = true; // force RTDB for leaderboard</script>
    <script type="module" src="leaderboard.js"></script>
    <script src="github.js"></script>
    <script src="game.js"></script>
  </body>
  </html>



